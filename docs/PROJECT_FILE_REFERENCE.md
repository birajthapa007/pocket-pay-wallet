# ğŸ“ Pocket Pay - Complete Project File Reference

> **A quick-reference guide for new developers to understand every file and their connections.**
> Last Updated: February 2026

---

## ğŸ—‚ï¸ Project Structure Overview

```
pocket-pay/
â”œâ”€â”€ docs/                    # Documentation
â”œâ”€â”€ public/                  # Static assets
â”œâ”€â”€ src/                     # Frontend source code
â”‚   â”œâ”€â”€ components/          # React components
â”‚   â”‚   â”œâ”€â”€ navigation/      # Navigation components
â”‚   â”‚   â”œâ”€â”€ screens/         # Page/screen components
â”‚   â”‚   â”œâ”€â”€ ui/              # Reusable UI components (shadcn)
â”‚   â”‚   â””â”€â”€ wallet/          # Wallet-specific components
â”‚   â”œâ”€â”€ data/                # Mock data & utilities
â”‚   â”œâ”€â”€ hooks/               # Custom React hooks
â”‚   â”œâ”€â”€ integrations/        # External service integrations
â”‚   â”œâ”€â”€ lib/                 # Utility functions
â”‚   â”œâ”€â”€ pages/               # Route pages
â”‚   â”œâ”€â”€ services/            # API service layer
â”‚   â”œâ”€â”€ test/                # Test setup & tests
â”‚   â””â”€â”€ types/               # TypeScript type definitions
â”œâ”€â”€ supabase/                # Backend (Edge Functions)
â”‚   â””â”€â”€ functions/           # API endpoints
â”‚       â”œâ”€â”€ _shared/         # Shared utilities
â”‚       â”œâ”€â”€ auth-otp/        # Authentication
â”‚       â”œâ”€â”€ banking/         # Deposit/Withdraw
â”‚       â”œâ”€â”€ cards/           # Virtual cards
â”‚       â”œâ”€â”€ requests/        # Money requests
â”‚       â”œâ”€â”€ send-auth-email/ # Email service
â”‚       â”œâ”€â”€ transactions/    # Transaction history
â”‚       â”œâ”€â”€ transfers/       # Send money
â”‚       â””â”€â”€ wallet/          # Wallet operations
â””â”€â”€ config files             # Root config files
```

---

## ğŸ¯ File-by-File Reference

---

## ğŸ“„ ROOT CONFIGURATION FILES

### `package.json`
- **Purpose**: Project dependencies and scripts
- **Key Dependencies**: React 18, Vite, TanStack Query, Supabase JS, Tailwind CSS, Framer Motion
- **DO NOT EDIT**: Managed by Lovable

### `vite.config.ts`
- **Purpose**: Vite bundler configuration
- **Key Settings**: 
  - Port 8080
  - Path alias `@/` â†’ `./src/`
  - HMR overlay disabled

### `tailwind.config.ts`
- **Purpose**: Tailwind CSS theme configuration
- **Defines**: Colors, spacing, animations, custom variants
- **Connected to**: `src/index.css`

### `tsconfig.json` / `tsconfig.app.json`
- **Purpose**: TypeScript compiler settings
- **Key**: Path mapping `@/*` for imports

### `components.json`
- **Purpose**: shadcn/ui configuration
- **Defines**: Component style, paths, aliases

### `.env`
- **Purpose**: Environment variables
- **Contains**: `VITE_SUPABASE_URL`, `VITE_SUPABASE_PUBLISHABLE_KEY`, `VITE_SUPABASE_PROJECT_ID`
- **DO NOT EDIT**: Auto-generated by Lovable Cloud

---

## ğŸ“ SRC/PAGES (Route Entry Points)

### `src/pages/Index.tsx` â­ MAIN FILE
- **Purpose**: Main application controller - THE BRAIN
- **What it does**:
  - Manages ALL screen navigation state
  - Handles authentication flow
  - Orchestrates data fetching via hooks
  - Renders appropriate screen based on `currentScreen` state
  - Manages send/receive/request flows
- **Connections**:
  - Uses ALL hooks (`useAuth`, `useWallet`, `useBanking`, `useSettings`)
  - Renders ALL screen components
  - Uses types from `@/types/wallet`
- **Key State**:
  - `currentScreen`: Which screen to show
  - `selectedRecipient`: Person to send/request from
  - `sendAmount`, `sendNote`: Transfer details
  - `lastTransaction`: For success screens

### `src/pages/NotFound.tsx`
- **Purpose**: 404 error page
- **Shows**: Link back to home

---

## ğŸ“ SRC/TYPES (Type Definitions)

### `src/types/wallet.ts`
- **Purpose**: Core TypeScript interfaces
- **Defines**:
  - `User`: id, name, username, phone, email, avatar
  - `Transaction`: id, type, amount, status, description, sender/recipient, createdAt, isRisky
  - `WalletBalance`: available, pending, total
  - `Card`: id, type, lastFour, cardNumber, expiryDate, cvv, cardholderName, isActive, isFrozen
  - `MoneyRequest`: id, amount, requester, requestedFrom, note, status
  - `Screen`: All possible screen names (union type)
  - `UserSettings`: notifications, security, privacy settings
- **Used by**: Almost every file

### `src/types/recipient.ts`
- **Purpose**: Extended user type with wallet
- **Defines**: `RecipientWithWallet` extends `User` with `wallet_id`
- **Used by**: Send/Request flows

---

## ğŸ“ SRC/HOOKS (Data & State Management)

### `src/hooks/useAuth.ts` â­ CRITICAL
- **Purpose**: Authentication state management
- **What it does**:
  - Listens to Supabase auth state changes
  - Provides `isLoggedIn`, `isLoading`, `user` state
  - Provides `signOut()` function
  - Clears query cache on auth changes
- **Connections**:
  - Uses `supabase` from integrations
  - Uses `useQueryClient` from TanStack Query
- **Returns**: `{ isLoggedIn, isLoading, user, authUser, signOut, updateUser }`

### `src/hooks/useWallet.ts` â­ CRITICAL
- **Purpose**: All wallet/transaction operations
- **Exports**:
  - `useWalletBalance()` - Get balance only
  - `useWalletSummary()` - Balance + transactions + profile + cards
  - `useContacts()` - Get user list
  - `useLookupUser()` - Find user by username
  - `useTransactions()` - Get transaction history
  - `useTransactionDetail()` - Single transaction
  - `useInsights()` - Spending analytics
  - `useSendMoney()` - Create transfer
  - `useConfirmTransfer()` - Confirm risky transfer
  - `useCancelTransfer()` - Cancel pending transfer
  - `useMoneyRequests()` - Get incoming/outgoing requests
  - `useCreateRequest()` - Create money request
  - `useAcceptRequest()` - Pay a request
  - `useDeclineRequest()` - Decline a request
  - `useCards()` - Get all cards
  - `useFreezeCard()` / `useUnfreezeCard()` - Card controls
  - `useCreateCard()` - Create virtual card
- **Connections**:
  - Uses `@/services/api` for all API calls
  - Uses `@/hooks/use-toast` for notifications

### `src/hooks/useBanking.ts`
- **Purpose**: Deposit and withdrawal operations
- **Exports**:
  - `useDeposit()` - Add money to wallet
  - `useWithdraw()` - Cash out (standard/instant)
- **Connections**:
  - Calls `banking` edge function directly
  - Uses `sonner` for toast notifications

### `src/hooks/useSettings.ts`
- **Purpose**: User settings management (local storage)
- **Stores**: Notification, security, privacy preferences
- **Note**: Settings are client-side only, not synced to backend

### `src/hooks/use-toast.ts`
- **Purpose**: Toast notification system
- **Provides**: `toast()` function for alerts

### `src/hooks/use-mobile.tsx`
- **Purpose**: Responsive breakpoint detection
- **Returns**: `isMobile` boolean

---

## ğŸ“ SRC/SERVICES (API Layer)

### `src/services/api.ts` â­ CRITICAL
- **Purpose**: All backend API communication
- **What it does**:
  - Defines response types matching backend
  - Provides `apiCall()` helper with auth token
  - Exports API objects for each domain:

| API Object | Purpose | Edge Function |
|------------|---------|---------------|
| `walletApi` | Balance, summary, lookup, contacts | `/wallet` |
| `transfersApi` | Send, confirm, cancel, status | `/transfers` |
| `requestsApi` | Create, accept, decline, cancel, list | `/requests` |
| `transactionsApi` | List, detail, insights | `/transactions` |
| `cardsApi` | List, detail, freeze, unfreeze, create | `/cards` |
| `authApi` | Send OTP, verify OTP (signup/login) | `/auth-otp` |

- **Connections**:
  - Uses `supabase` client for auth tokens
  - Uses env vars for API URL

---

## ğŸ“ SRC/COMPONENTS/SCREENS (UI Screens)

### Authentication & Onboarding

| File | Purpose | Key Props |
|------|---------|-----------|
| `AuthScreen.tsx` | Login/signup with OTP or password | `onSuccess` |
| `OnboardingScreen.tsx` | Welcome tutorial (not currently used) | `onComplete` |

### Home & Navigation

| File | Purpose | Key Props |
|------|---------|-----------|
| `HomeScreen.tsx` | Main dashboard - balance, actions, recent activity | `balance`, `transactions`, `user`, `onSend`, `onReceive`, etc. |
| `HistoryScreen.tsx` | Full transaction history with filters | `transactions`, `onTransactionClick` |
| `InsightsScreen.tsx` | Spending analytics with charts | `transactions` |
| `SettingsScreen.tsx` | Settings menu | `user`, `onNavigate`, `onLogout` |

### Send Money Flow

| File | Purpose | Key Props |
|------|---------|-----------|
| `SendScreen.tsx` | Select recipient (search users) | `contacts`, `onSelectRecipient`, `onBack` |
| `SendAmountScreen.tsx` | Enter amount & note | `recipient`, `balance`, `onSetAmount`, `onBack` |
| `SendConfirmScreen.tsx` | Review & confirm | `recipient`, `amount`, `note`, `onConfirm`, `isLoading` |
| `SendSuccessScreen.tsx` | Success/pending result | `recipient`, `amount`, `transaction`, `onDone` |

### Receive & Request Flow

| File | Purpose | Key Props |
|------|---------|-----------|
| `ReceiveScreen.tsx` | Show QR code for receiving | `user`, `onBack` |
| `RequestScreen.tsx` | Select who to request from | `contacts`, `onSelectRecipient`, `onBack` |
| `RequestAmountScreen.tsx` | Enter request amount | `requestFrom`, `onSetAmount`, `onBack` |
| `RequestSuccessScreen.tsx` | Request sent confirmation | `requestFrom`, `amount`, `onDone` |

### Banking (Deposit/Withdraw)

| File | Purpose | Key Props |
|------|---------|-----------|
| `DepositScreen.tsx` | Add money to wallet | `onBack`, `onNavigate` |
| `WithdrawScreen.tsx` | Cash out (standard/instant) | `onBack`, `onNavigate` |

### Profile & Settings

| File | Purpose | Key Props |
|------|---------|-----------|
| `ProfileScreen.tsx` | Edit user profile | `user`, `onUpdate`, `onBack` |
| `SecurityScreen.tsx` | Security settings | `settings`, `onUpdate`, `onBack` |
| `NotificationsScreen.tsx` | Notification preferences | `settings`, `onUpdate`, `onBack` |
| `HelpScreen.tsx` | FAQ & support | `onBack` |
| `TermsScreen.tsx` | Terms of service | `onBack` |
| `PrivacyScreen.tsx` | Privacy policy | `onBack` |

### Cards

| File | Purpose | Key Props |
|------|---------|-----------|
| `CardsScreen.tsx` | View & manage virtual cards | `onBack`, `onNavigate` |

### Transaction & Contact Details

| File | Purpose | Key Props |
|------|---------|-----------|
| `TransactionDetailScreen.tsx` | Single transaction view | `transaction`, `onBack`, `onViewProfile` |
| `ContactProfileScreen.tsx` | View contact & history | `contact`, `transactions`, `onSend`, `onRequest` |

### Utilities

| File | Purpose | Key Props |
|------|---------|-----------|
| `ScanScreen.tsx` | QR code scanner | `onUserFound`, `onBack` |

---

## ğŸ“ SRC/COMPONENTS/NAVIGATION

### `BottomNav.tsx`
- **Purpose**: Bottom navigation bar
- **Shows**: Home, Activity, Insights, Settings
- **Props**: `currentScreen`, `onNavigate`
- **Used in**: `Index.tsx` (conditionally shown)

---

## ğŸ“ SRC/COMPONENTS/WALLET

### `TransactionItem.tsx`
- **Purpose**: Single transaction row in lists
- **Shows**: Icon, name, amount, status, time
- **Props**: `transaction`, `onClick`

### `PendingRequests.tsx`
- **Purpose**: Show incoming/outgoing money requests
- **Shows**: Accept/decline buttons for incoming
- **Props**: `incoming`, `outgoing`, `onAccept`, `onDecline`

---

## ğŸ“ SRC/COMPONENTS/UI (shadcn Components)

> These are reusable UI primitives from shadcn/ui. Key ones used:

| Component | Usage |
|-----------|-------|
| `button.tsx` | All buttons (variants: default, send, receive, etc.) |
| `input.tsx` | Text inputs |
| `card.tsx` | Card containers |
| `dialog.tsx` | Modal dialogs |
| `toast.tsx` / `toaster.tsx` | Notifications |
| `avatar.tsx` | User avatars |
| `badge.tsx` | Status badges |
| `tabs.tsx` | Tab navigation |
| `skeleton.tsx` | Loading states |
| `switch.tsx` | Toggle switches |

### `SecurityBadge.tsx`
- **Custom component**: Shows security status indicator

---

## ğŸ“ SRC/DATA

### `mockData.ts`
- **Purpose**: Mock data for development & fallbacks
- **Exports**:
  - `currentUser`, `contacts`: Sample users
  - `walletBalance`, `transactions`: Sample data
  - `cards`, `moneyRequests`: Sample cards/requests
  - `formatCurrency()`: Format number as USD
  - `formatRelativeTime()`: "2h ago" format
  - `formatCardNumber()`: Mask card numbers
  - `getContactFinancials()`: Calculate stats between users

---

## ğŸ“ SRC/INTEGRATIONS/SUPABASE

### `client.ts`
- **Purpose**: Supabase client singleton
- **Exports**: `supabase` - configured client instance
- **DO NOT EDIT**: Auto-generated

### `types.ts`
- **Purpose**: Database types auto-generated from schema
- **Contains**: All table types, enums, function signatures
- **DO NOT EDIT**: Auto-generated

---

## ğŸ“ SRC/LIB

### `utils.ts`
- **Purpose**: Utility functions
- **Exports**: `cn()` - Tailwind class merger

---

## ğŸ“ SRC (Root Files)

### `App.tsx`
- **Purpose**: Application root with providers
- **Sets up**:
  - `QueryClientProvider` (TanStack Query)
  - `TooltipProvider`
  - `Toaster` components
  - `BrowserRouter` with routes
- **Routes**:
  - `/` â†’ `Index` (main app)
  - `*` â†’ `NotFound`

### `main.tsx`
- **Purpose**: React entry point
- **Renders**: `<App />` to `#root`

### `index.css`
- **Purpose**: Global styles & CSS variables
- **Defines**:
  - Color tokens (HSL format)
  - Dark theme by default
  - Custom animations
  - Utility classes

### `App.css`
- **Purpose**: Additional global styles (minimal)

---

## ğŸ“ SUPABASE/FUNCTIONS (Backend Edge Functions)

### `_shared/cors.ts`
- **Purpose**: CORS configuration
- **Exports**: `getCorsHeaders()`, `handleCorsPreflightRequest()`
- **Used by**: All edge functions

### `_shared/validation.ts`
- **Purpose**: Input validation utilities
- **Exports**:
  - `isValidUUID()` - Validate UUID format
  - `validateAmount()` - Check amount is valid positive number
  - `validateDescription()` - Sanitize text input
  - `validatePagination()` - Validate limit/offset
  - `sanitizeText()` - Clean text input
  - `validationError()` - Create error response

### `_shared/encryption.ts`
- **Purpose**: Card data encryption
- **Exports**: `encrypt()`, `decrypt()` using AES-256-GCM

---

### `auth-otp/index.ts` â­ AUTHENTICATION
- **Purpose**: Custom OTP authentication
- **Actions**:
  - `?action=send` - Generate & email 6-digit OTP
  - `?action=verify` - Verify OTP, create/login user
  - `?action=admin-set-password` - Admin password reset
- **Flow**:
  1. User enters email â†’ OTP generated & stored in `otp_codes` table
  2. Email sent via Resend API (noreply@wenevertrust.com)
  3. User enters code â†’ Verified â†’ Magic link token generated
  4. Client uses token to create session
- **Security**:
  - 30-minute OTP expiry
  - 1-second delay on wrong code
  - Password support for signup

---

### `wallet/index.ts` â­ WALLET OPERATIONS
- **Purpose**: Balance & user operations
- **Actions**:
  - `?action=balance` - Get wallet balance
  - `?action=summary` - Balance + transactions + profile + cards
  - `?action=lookup&username=xxx` - Find user by username
  - `?action=contacts` - List all users (for contacts)
- **Data Flow**:
  - Validates JWT token
  - Gets user's wallet from `wallets` table
  - Calculates balance from `ledger_entries` table
  - Returns formatted response

---

### `transfers/index.ts` â­ SEND MONEY
- **Purpose**: Peer-to-peer transfers
- **Actions**:
  - `?action=send` (POST) - Create transfer
  - `?action=confirm` (POST) - Confirm risky transfer
  - `?action=cancel` (POST) - Cancel pending transfer
  - `?action=status` (GET) - Get transfer status
- **Risk Assessment**:
  1. Large transfer (> $500 threshold)
  2. First-time recipient
  3. Rapid transfers (> 5 in 60 minutes)
- **Flow** (non-risky):
  1. Create `transactions` record with status `created`
  2. Call `atomic_transfer()` database function
  3. Update status to `completed`
- **Flow** (risky):
  1. Create with status `pending_confirmation`
  2. Wait for user confirmation
  3. Then execute transfer

---

### `requests/index.ts`
- **Purpose**: Money request management
- **Actions**:
  - `?action=create` (POST) - Create request
  - `?action=accept` (POST) - Pay request (triggers transfer)
  - `?action=decline` (POST) - Decline request
  - `?action=cancel` (POST) - Cancel own request
  - `?action=list` (GET) - List incoming/outgoing

---

### `transactions/index.ts`
- **Purpose**: Transaction history & insights
- **Actions**:
  - `?action=list` - Get transactions (with filters)
  - `?action=detail` - Single transaction details
  - `?action=insights` - Spending analytics
- **Features**:
  - Adds `is_outgoing` flag for perspective
  - Joins sender/recipient profiles
  - Calculates period summaries

---

### `cards/index.ts`
- **Purpose**: Virtual card management
- **Actions**:
  - `?action=list` - Get all user's cards
  - `?action=detail` - Card with decrypted data
  - `?action=freeze` - Freeze card
  - `?action=unfreeze` - Unfreeze card
  - `?action=create` - Create new virtual card

---

### `banking/index.ts`
- **Purpose**: Deposit and withdrawal
- **Actions**:
  - `?action=deposit` (POST) - Add funds
  - `?action=withdraw` (POST) - Cash out
- **Withdrawal Options**:
  - Standard: Free, 1-3 business days
  - Instant: 1.5% fee, immediate

---

### `send-auth-email/index.ts`
- **Purpose**: Email sending via Resend (legacy)
- **Note**: Now handled by `auth-otp`

---

## ğŸ”— FILE CONNECTION DIAGRAM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER INTERFACE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   App.tsx â”€â”€â–º Index.tsx (MAIN CONTROLLER)                          â”‚
â”‚                    â”‚                                                â”‚
â”‚                    â”œâ”€â”€â–º AuthScreen.tsx                              â”‚
â”‚                    â”œâ”€â”€â–º HomeScreen.tsx                              â”‚
â”‚                    â”œâ”€â”€â–º SendScreen.tsx â†’ SendAmountScreen â†’ ...     â”‚
â”‚                    â”œâ”€â”€â–º ReceiveScreen.tsx                           â”‚
â”‚                    â”œâ”€â”€â–º RequestScreen.tsx â†’ RequestAmountScreen â†’ ..â”‚
â”‚                    â”œâ”€â”€â–º HistoryScreen.tsx                           â”‚
â”‚                    â”œâ”€â”€â–º InsightsScreen.tsx                          â”‚
â”‚                    â”œâ”€â”€â–º SettingsScreen.tsx                          â”‚
â”‚                    â”‚         â””â”€â”€â–º ProfileScreen, SecurityScreen...  â”‚
â”‚                    â”œâ”€â”€â–º CardsScreen.tsx                             â”‚
â”‚                    â””â”€â”€â–º DepositScreen.tsx, WithdrawScreen.tsx       â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          DATA LAYER                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Index.tsx                                                         â”‚
â”‚       â”‚                                                             â”‚
â”‚       â”œâ”€â”€â–º useAuth.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚       â”‚                                      â”‚                      â”‚
â”‚       â”œâ”€â”€â–º useWallet.ts â”€â”€â”€â–º api.ts â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º supabase/client.ts â”‚
â”‚       â”‚                                      â”‚                      â”‚
â”‚       â”œâ”€â”€â–º useBanking.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚       â”‚                                                             â”‚
â”‚       â””â”€â”€â–º useSettings.ts (local storage only)                      â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          BACKEND (Edge Functions)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   api.ts makes HTTP calls to:                                       â”‚
â”‚       â”‚                                                             â”‚
â”‚       â”œâ”€â”€â–º /auth-otp â”€â”€â”€â”€â”€â”€â”€â”€ supabase/functions/auth-otp/          â”‚
â”‚       â”œâ”€â”€â–º /wallet â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ supabase/functions/wallet/            â”‚
â”‚       â”œâ”€â”€â–º /transfers â”€â”€â”€â”€â”€â”€â”€ supabase/functions/transfers/         â”‚
â”‚       â”œâ”€â”€â–º /requests â”€â”€â”€â”€â”€â”€â”€â”€ supabase/functions/requests/          â”‚
â”‚       â”œâ”€â”€â–º /transactions â”€â”€â”€â”€ supabase/functions/transactions/      â”‚
â”‚       â”œâ”€â”€â–º /cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ supabase/functions/cards/             â”‚
â”‚       â””â”€â”€â–º /banking â”€â”€â”€â”€â”€â”€â”€â”€â”€ supabase/functions/banking/           â”‚
â”‚                                                                     â”‚
â”‚   All edge functions use:                                           â”‚
â”‚       â”œâ”€â”€â–º _shared/cors.ts                                          â”‚
â”‚       â”œâ”€â”€â–º _shared/validation.ts                                    â”‚
â”‚       â””â”€â”€â–º _shared/encryption.ts (cards only)                       â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          DATABASE (PostgreSQL)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Tables:                                                           â”‚
â”‚       â”œâ”€â”€â–º profiles â”€â”€â”€â”€â”€â”€â”€â”€ User profiles                          â”‚
â”‚       â”œâ”€â”€â–º wallets â”€â”€â”€â”€â”€â”€â”€â”€â”€ One per user                           â”‚
â”‚       â”œâ”€â”€â–º ledger_entries â”€â”€ Balance changes (append-only)          â”‚
â”‚       â”œâ”€â”€â–º transactions â”€â”€â”€â”€ Transaction records                    â”‚
â”‚       â”œâ”€â”€â–º money_requests â”€â”€ Request money records                  â”‚
â”‚       â”œâ”€â”€â–º cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Virtual/physical cards                 â”‚
â”‚       â”œâ”€â”€â–º otp_codes â”€â”€â”€â”€â”€â”€â”€ OTP verification codes                 â”‚
â”‚       â””â”€â”€â–º risk_settings â”€â”€â”€ Fraud detection thresholds             â”‚
â”‚                                                                     â”‚
â”‚   Functions:                                                        â”‚
â”‚       â”œâ”€â”€â–º get_wallet_balance(wallet_id)                            â”‚
â”‚       â”œâ”€â”€â–º get_pending_balance(wallet_id)                           â”‚
â”‚       â”œâ”€â”€â–º atomic_transfer(sender, recipient, amount, ...)          â”‚
â”‚       â”œâ”€â”€â–º atomic_debit_balance(...)                                â”‚
â”‚       â”œâ”€â”€â–º atomic_credit_balance(...)                               â”‚
â”‚       â”œâ”€â”€â–º is_wallet_owner(wallet_id, user_id)                      â”‚
â”‚       â”œâ”€â”€â–º get_user_wallet_id(user_id)                              â”‚
â”‚       â””â”€â”€â–º handle_new_user() (trigger on auth.users)                â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ KEY FLOWS

### 1. User Signup Flow
```
AuthScreen (email input)
    â†“
api.ts â†’ authApi.sendOtpEmail()
    â†“
auth-otp edge function â†’ generates OTP â†’ stores in otp_codes â†’ sends email
    â†“
AuthScreen (OTP input)
    â†“
api.ts â†’ authApi.verifyOtpSignup()
    â†“
auth-otp edge function â†’ verifies â†’ creates user â†’ generates session token
    â†“
handle_new_user trigger â†’ creates profile, wallet, welcome bonus, virtual card
    â†“
useAuth detects session â†’ navigates to HomeScreen
```

### 2. Send Money Flow
```
HomeScreen â†’ "Send" button
    â†“
SendScreen â†’ search/select recipient
    â†“
useLookupUser() â†’ wallet edge function â†’ gets recipient wallet_id
    â†“
SendAmountScreen â†’ enter amount & note
    â†“
SendConfirmScreen â†’ review details
    â†“
useSendMoney() â†’ transfers edge function
    â†“
Risk check â†’ if risky: pending_confirmation, if not: atomic_transfer
    â†“
ledger_entries updated â†’ transaction status â†’ completed
    â†“
SendSuccessScreen â†’ done
```

### 3. Receive Money Request Flow
```
HomeScreen shows PendingRequests
    â†“
User clicks "Pay"
    â†“
useAcceptRequest() â†’ requests edge function â†’ ?action=accept
    â†“
Creates transaction â†’ atomic_transfer â†’ marks request as accepted
    â†“
Requester's balance increases â†’ HomeScreen refreshes
```

---

## ğŸ“Š TYPE MAPPINGS

| Frontend Type | Backend Table | Edge Function |
|--------------|---------------|---------------|
| `User` | `profiles` | `wallet` |
| `Transaction` | `transactions` | `transactions`, `transfers` |
| `WalletBalance` | `ledger_entries` (calculated) | `wallet` |
| `Card` | `cards` | `cards` |
| `MoneyRequest` | `money_requests` | `requests` |

---

## ğŸ¨ STYLING SYSTEM

| File | Purpose |
|------|---------|
| `tailwind.config.ts` | Theme colors, fonts, animations |
| `src/index.css` | CSS variables (--primary, --background, etc.) |
| `src/App.css` | Minimal global styles |
| `src/components/ui/*.tsx` | Pre-styled shadcn components |

**Color System** (HSL in index.css):
- `--background`: Dark background
- `--foreground`: Text color
- `--primary`: Teal accent (#2dd4bf)
- `--secondary`: Muted backgrounds
- `--destructive`: Error states (red)
- `--success`: Success states (green)

---

## ğŸ§ª TESTING

### `src/test/setup.ts`
- **Purpose**: Vitest configuration

### `src/test/example.test.ts`
- **Purpose**: Sample test

### `vitest.config.ts`
- **Purpose**: Test runner configuration

---

## ğŸ“ QUICK REFERENCE: "What file do I edit for...?"

| Task | File(s) |
|------|---------|
| Change login flow | `AuthScreen.tsx`, `api.ts`, `auth-otp/index.ts` |
| Add new screen | Create in `screens/`, add to `Index.tsx` switch |
| Modify balance calculation | `wallet/index.ts`, database functions |
| Change send flow | `SendScreen.tsx` â†’ `SendSuccessScreen.tsx`, `transfers/index.ts` |
| Add new API endpoint | Create in `supabase/functions/`, add to `api.ts` |
| Modify colors/theme | `tailwind.config.ts`, `index.css` |
| Add new data hook | `useWallet.ts` or create new hook |
| Change card behavior | `CardsScreen.tsx`, `cards/index.ts` |
| Modify risk rules | `transfers/index.ts`, `risk_settings` table |
| Add new database table | Use migration tool, update types |

---

## âš ï¸ IMPORTANT NOTES

1. **DO NOT EDIT**:
   - `src/integrations/supabase/client.ts`
   - `src/integrations/supabase/types.ts`
   - `.env`
   - `supabase/migrations/`

2. **Ledger-based**: Balance is CALCULATED from `ledger_entries`, never stored directly

3. **Single transaction record**: P2P transfers create ONE record; frontend shows send/receive based on perspective

4. **Edge functions auto-deploy**: Changes to `supabase/functions/` deploy automatically

5. **All money in cents internally**: Database stores decimals, display formats with `formatCurrency()`

---

*This guide should give any new developer a complete understanding of the Pocket Pay codebase.*
